env <- readRDS("~/Desktop/env.rds")
dim(env)
mod0 <- dbrda(dist ~ 1, env)  # Model with intercept only
mod1 <- dbrda(dist ~ ., env)  # Model with all explanatory variables
set.seed(100)
mod <- ordistep(mod0, scope = formula(mod1))
mod$anova
library(microseq)
library(tidyverse)
db <- readFasta("~/Desktop/Fierer/Strains/trnL_taxDB_20250217.fasta")
View(db)
View(db)
db <- readFasta("~/Desktop/Fierer/Strains/trnL_taxDB_20250217.fasta") %>%
separate(Header, into = c("Junk", "Kingdom", "Phylum", "Class", "Order", "Family",
"Genus", "Species"), sep = ";") %>%
select(-Junk) %>%
mutate(Header = paste(Kingdom, Phylum, Class, Order, Family,
Genus, Species, sep = ";")) %>%
select(Header, Sequence)
View(db)
writeFasta(db, "~/Desktop/Fierer/Strains/trnL_taxDB_20250217_dada2.fasta")
library(microseq)
library(tidyverse)
bbdb <- readFasta("~/Downloads/all_prok_16S_species_consensus_dada2.fa.gz")
View(bbdb)
bbdb_check <- bbdb %>%
separate(Header,
into = c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species"),
sep = ";")
View(bbdb_check)
table(bbdb_check$Kingdom)
bbdb_check <- bbdb %>%
separate(Header,
into = c("Kingdom", "Phylum", "Class", "Order", "Family", "Genus", "Species"),
sep = ";")
citation("vegan")
citation("ANCOMBC")
library(igraph)
citation("igraph")
library(ggplto2)
library(ggplot2)
citation("ggplot2")
d <- read.csv("~/Documents/GitHub/AussieStrains/data/metadata_331.csv")
table(d$vegetation_type)
# Select 15 arid grassland and 15 forest soils from BASE
library(tidyverse)
grassland <- d %<%
filter(vegetation_type == "Grassland")
grassland <- d %>%
filter(vegetation_type == "Grassland")
hist(grassland$AI)
grassland <- d %>%
filter(vegetation_type == "Grassland") %>%
arrange(AI)
View(grassland)
head(grassland, n = 15)
head(grassland$sampleID, n = 15)
forest <- d %>%
filter(vegetation_type == "Forest") %>%
arrange(AI)
head(forest$sampleID, n = 15)
hist(forest$AI)
forest <- d %>%
filter(vegetation_type == "Forest") %>%
arrange(desc(AI))
hist(forest$AI)
head(forest$AI, n = 15)
head(grassland$AI, n = 15)
head(grassland$sampleID, n = 15)
head(forest$sampleID, n = 15)
accession2url <- function(x) {
prefix <- "ftp://ftp.sra.ebi.ac.uk/vol1/fastq"
dir1 <- paste0("/",substr(x,1,6))
dir2 <- ifelse(nchar(x) == 9, "",
ifelse(nchar(x) == 10, paste0("/00",substr(x,10,10)),
ifelse(nchar(x) == 11, paste0("/0",substr(x,10,11)),
paste0("/",substr(x,10,12)))))
paste0(prefix,dir1,dir2,"/",x)
}
accession2url(ERR3452699)
accession2url("ERR3452699")
accession2urlR1 <- function(x) {
prefix <- "ftp://ftp.sra.ebi.ac.uk/vol1/fastq"
dir1 <- paste0("/",substr(x,1,6))
dir2 <- ifelse(nchar(x) == 9, "",
ifelse(nchar(x) == 10, paste0("/00",substr(x,10,10)),
ifelse(nchar(x) == 11, paste0("/0",substr(x,10,11)),
paste0("/",substr(x,10,12)))))
paste0(prefix,dir1,dir2,"/",x,"/",x,"_1.fastq.gz")
}
accession2url("ERR3452699")
accession2urlR1("ERR3452699")
accession2urlR2 <- function(x) {
prefix <- "ftp://ftp.sra.ebi.ac.uk/vol1/fastq"
dir1 <- paste0("/",substr(x,1,6))
dir2 <- ifelse(nchar(x) == 9, "",
ifelse(nchar(x) == 10, paste0("/00",substr(x,10,10)),
ifelse(nchar(x) == 11, paste0("/0",substr(x,10,11)),
paste0("/",substr(x,10,12)))))
paste0(prefix,dir1,dir2,"/",x,"/",x,"_2.fastq.gz")
}
accession2urlR2("ERR3452699")
accession2urlR1("ERR3452574")
accession2urlR2("ERR3452574")
accession2urlR1("ERR3452529")
accession2urlR2("ERR3452529")
accession2urlR1("ERR3452318")
accession2urlR2("ERR3452318")
accession2urlR1("ERR3452699")
accession2urlR2("ERR3452699")
accession2urlR1("ERR3452574")
accession2urlR2("ERR3452574")
accession2urlR1("ERR3452529")
accession2urlR2("ERR3452529")
accession2urlR1("ERR3452318")
accession2urlR2("ERR3452318")
accession2urlR1("ERR3451635")
accession2urlR2("ERR3451635")
accession2urlR1("ERR2641799")
accession2urlR2("ERR2641799")
accession2urlR1("ERR2641792")
accession2urlR2("ERR2641792")
accession2urlR1("ERR2641793")
accession2urlR2("ERR2641793")
accession2urlR1("ERR2641795")
accession2urlR2("ERR2641795")
accession2urlR1("ERR2641798")
accession2urlR2("ERR2641798")
install.packages("neonUtilities")
install.packages("neonOS")
library(neonUtilities)
library(neonOS)
library(tidyverse)
soilChem <- loadByProduct(dpID = 'DP1.10086.001',
startdate = "2017-01",
enddate = "2019-12",
check.size = FALSE,
site = soilTrialSites,
package = 'expanded')
soilTrialSites = c("BONA","DEJU","HEAL","TOOL","BARR")
soilChem <- loadByProduct(dpID = 'DP1.10086.001',
startdate = "2017-01",
enddate = "2019-12",
check.size = FALSE,
site = soilTrialSites,
package = 'expanded')
packageVersion("data.table")
install.packages("data.table")
install.packages("data.table")
install.packages("data.table")
library(remotes)
install_version("data.table", version = "1.14.3", repos = "http://cran.us.r-project.org")
install_version("data.table", version = "1.14.4", repos = "http://cran.us.r-project.org")
install_version("data.table", version = "1.14.4", repos = "http://cran.us.r-project.org")
pkgbuild::check_build_tools(debug = TRUE)
install.packages("data.table")
x <- 1
rm(x)
library(neonUtilities)
library(neonOS)
library(tidyverse)
soilTrialSites = c("BONA","DEJU","HEAL","TOOL","BARR")
soilChem <- loadByProduct(dpID = 'DP1.10086.001',
startdate = "2017-01",
enddate = "2019-12",
check.size = FALSE,
site = soilTrialSites,
package = 'expanded')
View(soilChem$sls_soilChemistry)
View(soilChem$sls_metagenomicsPooling)
soilChem$sls_metagenomicsPooling$genomicsPooledIDList[11]
# you can check to confirm the first sample is TOOL_043-O-20170719-COMP
soilChem$sls_metagenomicsPooling[11,'genomicsSampleID']
View(soilChem$sls_soilChemistry %>%
filter(sampleID == "TOOL_043-O-5-7-20170719") %>%
select(sampleID,d15N,organicd13C,CNratio))
# split up the pooled list into new columns
genomicSamples <- soilChem$sls_metagenomicsPooling %>%
tidyr::separate(genomicsPooledIDList, into=c("first","second","third"),sep="\\|",fill="right") %>%
dplyr::select(genomicsSampleID,first,second,third)
# now view the table
View(genomicSamples)
genSampleExample <- genomicSamples %>%
tidyr::pivot_longer(cols=c("first","second","third"),values_to = "sampleID") %>%
dplyr::select(sampleID,genomicsSampleID) %>%
drop_na()
# now view
View(genSampleExample)
chemEx <- soilChem$sls_soilChemistry %>%
dplyr::select(sampleID,d15N,organicd13C,nitrogenPercent,organicCPercent)
## now combine the tables
combinedTab <- left_join(genSampleExample,chemEx, by = "sampleID") %>% drop_na()
View(combinedTab)
# Multiple samples composited to the genomic sample
# So, need to average
genome_groups <- combinedTab %>%
group_by(genomicsSampleID) %>%
summarize_at(c("d15N","organicd13C","nitrogenPercent","organicCPercent"), mean)
View(genome_groups)
# Be careful with pH
soilpH_Example <- soilChem$sls_soilpH %>%
dplyr::filter(sampleID %in% combinedTab$sampleID) %>%
dplyr::select(sampleID,soilInWaterpH,soilInCaClpH)
# have a look at this table
View(soilpH_Example)
# now join with the existing table
combinedTab_pH <- left_join(combinedTab,soilpH_Example, by = "sampleID")
# and the final
View(combinedTab_pH)
install.packages("respirometry")
library(respirometry)
genome_groups_pH <- combinedTab_pH %>%
group_by(genomicsSampleID) %>%
summarize_at(c("soilInWaterpH","soilInCaClpH"), mean_pH)
View(genome_groups_pH)
genome_groups_all <- combinedTab_pH %>%
group_by(genomicsSampleID) %>%
{left_join(
summarize_at(.,vars("d15N","organicd13C","nitrogenPercent","organicCPercent"), mean),
summarize_at(.,vars("soilInWaterpH","soilInCaClpH"), mean_pH)
)}
View(genome_groups_all)
#specify sites and/or date ranges depending on your research questions
metaGdata <- loadByProduct(dpID = 'DP1.10107.001',
startdate = "2018-01",
enddate = "2019-12",
check.size = FALSE,
package = 'expanded')
rawFileInfo <- metaGdata$mms_rawDataFiles
View(rawFileInfo)
urls_fordownload <- unique(rawFileInfo$rawDataFilePath)
urls_fordownload
# Subsetting
# Option a, create a list of samples from earlier example
targetsamples <- combinedTab$genomicsSampleID
# Create a genomicsSampleID from raw files table, and then subset this to samples
rawfiles_ids <- rawFileInfo %>%
mutate(genomicsSampleID = gsub("-DNA[1,2,3]","",dnaSampleID)) %>%
subset(genomicsSampleID %in% targetsamples) %>%
unique()
urls_fordownload <- unique(rawfiles_ids$rawDataFilePath)
# Option b
urls_fordownload <- unique(rawFileInfo$rawDataFilePath)[1:20] #for instance, the first 20 rows, and so on
#### 3. Real ####
metaGdata <- loadByProduct(dpID = 'DP1.10107.001',
startdate = "2023-01",
enddate = "2023-12",
check.size = FALSE,
package = 'expanded')
#### 3. Real ####
metaGdata <- loadByProduct(dpID = 'DP1.10107.001',
startdate = "2022-01",
enddate = "2022-12",
check.size = FALSE,
package = 'expanded')
View(metaGdata)
rawFileInfo <- metaGdata$mms_rawDataFiles
View(rawFileInfo)
#### 3. Real ####
soilChem <- loadByProduct(dpID = 'DP1.10086.001',
startdate = "2023-01",
enddate = "2023-12",
check.size = FALSE,
site = soilTrialSites,
package = 'expanded')
View(soilChem$sls_soilChemistry)
library(devtools)
install.packages("devtools")
library(devtools)
install_github("NEONScience/phyloNEON/phyloNEON")
install_github("NEONScience/phyloNEON/phyloNEON")
library(remotes)
install_github("NEONScience/phyloNEON/phyloNEON")
install_github("NEONScience/phyloNEON")
install_github("NEONScience/phyloNEON/")
#### 1. Setup ####
library(neonUtilities)
library(neonOS)
library(tidyverse)
library(respirometry)
library(devtools)
devtools::install_github("NEONScience/phyloNEON")
Sys.unsetenv("GITHUB_PAT")
devtools::install_github("NEONScience/phyloNEON")
Sys.unsetenv("GITHUB_PAT")
devtools::install_github("NEONScience/phyloNEON")
Sys.setenv(GITHUB_PAT = "")
devtools::install_github("NEONScience/phyloNEON")
remotes::install_github(
"NEONScience/phyloNEON",
auth_token = NULL,
upgrade = "never"
)
remotes::install_github(
"NEONScience/phyloNEON",
auth_token = NULL,
upgrade = "never"
)
#### 1. Setup ####
library(neonUtilities)
library(neonOS)
library(tidyverse)
library(respirometry)
library(devtools)
library(remotes)
Sys.setenv(GITHUB_PAT = "")
remotes::install_github(
"NEONScience/phyloNEON",
auth_token = NULL,
upgrade = "never"
)
remotes::install_github(
"NEONScience/phyloNEON/phyloNEON",
auth_token = NULL,
upgrade = "never"
)
library(phyloNEON)
View(neon.metaDB)
metaDB <- data("neon.metaDB")
View(neon.metaDB)
jgi <- metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)")
jgi <- metaDB %>%
dplyr::filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)")
jgi <- metaDB %>%
filter("Sequencing Center" == "DOE Joint Genome Institute  (JGI)")
rm(metaDB)
jgi <- neon.metaDB %>%
filter("Sequencing Center" == "DOE Joint Genome Institute  (JGI)")
View(neon.metaDB)
jgi <- neon.metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)")
table(jgi$collectDate)
jgi$collectDate
jgi <- neon.metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)") %>%
mutate(Year = substr(collectDate, start = 1, stop = 5))
table(jgi$Year)
jgi <- neon.metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)") %>%
mutate(Year = substr(collectDate, start = 1, stop = 4))
table(jgi$Year)
jgi <- neon.metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)") %>%
mutate(Year = substr(collectDate, start = 1, stop = 4)) %>%
filter(Year == 2023)
table(jgi$Ecosystem)
table(jgi$`Ecosystem Category`)
table(jgi$`Ecosystem Subtype`)
table(jgi$`Ecosystem Type`)
table(jgi$`Specific Ecosystem`)
table(jgi$jgiProjectID)
table(jgi$`ITS Proposal ID`)
table(jgi$`Sequencing Status`)
table(jgi$`Study Name`)
table(jgi$`Funding Program`)
table(jgi$`Sequencing Method`)
table(jgi$siteID)
jgi <- neon.metaDB %>%
filter(`Sequencing Center` == "DOE Joint Genome Institute  (JGI)") %>%
mutate(Year = substr(collectDate, start = 1, stop = 4)) %>%
filter(Year == 2023) %>%
filter(`Ecosystem Category` == "Terrestrial")
table(jgi$Ecosystem)
table(jgi$`Ecosystem Category`) # 303 terrestrial (222 aquatic)
table(jgi$`Ecosystem Type`)
table(jgi$`Ecosystem Subtype`)
table(jgi$`Specific Ecosystem`)
table(jgi$`ITS Proposal ID`) # 509938 - use this on JGI portal?
table(jgi$`Sequencing Status`)
table(jgi$`Study Name`) # Soil and water microbial communities from various NEON Field Sites across the United States
table(jgi$`Funding Program`)
table(jgi$`Sequencing Method`)
table(jgi$siteID)
length(table(jgi$siteID))
hist(jgi$GenomeSize)
View(jgi)
hist(jgi$numberFilteredReads)
rane(jgi$numberFilteredReads)
range(jgi$numberFilteredReads)
library(gdm)
citation("gdm")
library(plyr) # For data manipulation
library(tidyverse) # For data manipulation
library(mctoolsr) # For microbial analyses
library(vegan) # For multivariate stats
library(RColorBrewer) # For colors
library(microseq) # For fastas
library(car) # For stats
library(MASS) # For stats
library(FSA) # For SE
library(lme4) # For LMER
library(emmeans) # For TukeyHSD
library(multcomp) # For cld
library(lmerTest) # For Sattherwaite df
library(afex) # For alternative mixed model
library(ggh4x) # For plots
library(ggrepel) # For plot text
library(cowplot) # For multipanel
library(phyloseq) # For networks
library(SpiecEasi) # For networks
library(igraph) # For networks
library(rnetcarto) # For networks
library(writexl) # Export
library(naniar) # For NA management
library(pheatmap) # For heatmaps
library(iCAMP) # NTI
library(ape) # Phylogenetics
library(phyloseq) # microbial analyses, can handle trees
library(picante) # Trees
library(conditionz)
library(taxize) # version 0.9.100.1 from archive
library(readxl)
# Repo Directory
setwd("~/Documents/GitHub/SunflowerG/")
# Functions
`%notin%` <- Negate(`%in%`)
find_hull <- function(df) df[chull(df$Axis01, df$Axis02),]
source("code/effectSize.R")
source("code/run_taxa_null_model.R")
source("code/run_div_null_model.R")
source("code/run_sclero_regressions.R")
MyDiamond <- function(coords, v=NULL, params) {
vertex.color <- params("vertex", "color")
if (length(vertex.color) != 1 && !is.null(v)) {
vertex.color <- vertex.color[v]
}
vertex.frame.color <- params("vertex", "frame.color")
if (length(vertex.frame.color) != 1 && !is.null(v)) {
vertex.frame.color <- vertex.frame.color[v]
}
vertex.size <- 1/200 * params("vertex", "size")
if (length(vertex.size) != 1 && !is.null(v)) {
vertex.size <- vertex.size[v]
}
symbols(x=coords[,1], y=coords[,2], bg=vertex.color, fg=vertex.frame.color,
stars=cbind(vertex.size, vertex.size, vertex.size, vertex.size),
add=TRUE, inches=FALSE)
}
add_shape("diamond", clip=shapes("circle")$clip,
plot=MyDiamond, parameters=list(vertex.frame.color="white",
vertex.frame.width=1))
mytriangle <- function(coords, v=NULL, params) {
vertex.color <- params("vertex", "color")
if (length(vertex.color) != 1 && !is.null(v)) {
vertex.color <- vertex.color[v]
}
vertex.size <- 1/200 * params("vertex", "size")
if (length(vertex.size) != 1 && !is.null(v)) {
vertex.size <- vertex.size[v]
}
symbols(x=coords[,1], y=coords[,2], bg=vertex.color,
stars=cbind(vertex.size, vertex.size, vertex.size),
add=TRUE, inches=FALSE)
}
add_shape("triangle", clip=shapes("circle")$clip,
plot=mytriangle)
#### _Start here ####
input_n3_16S <- readRDS("data/input_filt_16S_noSing.rds")
input_n3_ITS <- readRDS("data/input_filt_ITS_noSing.rds")
input_n3_16S$map_loaded$rich <- specnumber(input_n3_16S$data_loaded,
MARGIN = 2)
input_n3_16S$map_loaded$shannon <- vegan::diversity(input_n3_16S$data_loaded,
index = "shannon",
MARGIN = 2)
input_n3_ITS$map_loaded$rich <- specnumber(input_n3_ITS$data_loaded,
MARGIN = 2)
input_n3_ITS$map_loaded$shannon <- vegan::diversity(input_n3_ITS$data_loaded,
index = "shannon",
MARGIN = 2)
View(input_n3_ITS$data_loaded)
otu_table_ITS <- input_n3_ITS$data_loaded %>%
rownames_to_column(var = "OTU_ID")
View(otu_table_ITS)
View(input_n3_ITS$taxonomy_loaded)
# Format for FUNGuild
otu_table_ITS <- input_n3_ITS$data_loaded %>%
rownames_to_column(var = "OTU_ID") %>%
mutate(taxonomy = paste(input_n3_ITS$taxonomy_loaded$taxonomy1,
input_n3_ITS$taxonomy_loaded$taxonomy2,
input_n3_ITS$taxonomy_loaded$taxonomy3,
input_n3_ITS$taxonomy_loaded$taxonomy4,
input_n3_ITS$taxonomy_loaded$taxonomy5,
input_n3_ITS$taxonomy_loaded$taxonomy6,
sep = ";"))
View(otu_table_ITS)
write.table(otu_table_ITS, "data/otu_table_ITS.txt", sep = "\t")
write.table(otu_table_ITS, "data/otu_table_ITS.txt", sep = "\t", row.names = F)
# Format for FAPROTAX
otu_table_16S <- input_n3_16S$data_loaded %>%
mutate(taxonomy = paste(input_n3_16S$taxonomy_loaded$taxonomy1,
input_n3_16S$taxonomy_loaded$taxonomy2,
input_n3_16S$taxonomy_loaded$taxonomy3,
input_n3_16S$taxonomy_loaded$taxonomy4,
input_n3_16S$taxonomy_loaded$taxonomy5,
input_n3_16S$taxonomy_loaded$taxonomy6,
sep = ",")) %>%
dplyr::select(taxonomy, everything())
write.table(otu_table_16S, "data/otu_table_16S.txt", row.names = F, sep = "\t")
View(input_n3_16S$taxonomy_loaded)
# Format for FAPROTAX
otu_table_16S <- input_n3_16S$data_loaded %>%
mutate(taxonomy = paste(input_n3_16S$taxonomy_loaded$taxonomy1,
input_n3_16S$taxonomy_loaded$taxonomy2,
input_n3_16S$taxonomy_loaded$taxonomy3,
input_n3_16S$taxonomy_loaded$taxonomy4,
input_n3_16S$taxonomy_loaded$taxonomy5,
input_n3_16S$taxonomy_loaded$taxonomy6,
input_n3_16S$taxonomy_loaded$taxonomy8,
sep = ",")) %>%
dplyr::select(taxonomy, everything())
write.table(otu_table_16S, "data/otu_table_16S.txt", row.names = F, sep = "\t")
